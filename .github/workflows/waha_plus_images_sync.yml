name: Waha Plus Images Sync
on:
  workflow_dispatch:
    inputs:
      release_number:
        description: "Release number"
        required: false
        type: string
jobs:
  cpu_x86:
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Checkout sources
        uses: actions/checkout@v4
      - name: Login to Source Docker repository
        uses: docker/login-action@v3
        with:
          registry: ${{ vars.SOURCE_DOCKER_REPO_REGISTRY }}
          username: ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}
          password: ${{ secrets.SOURCE_DOCKER_REPO_TOKEN }}
      - name: Pull Waha Plus images
        run: |
          docker pull ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:latest
          docker pull ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:gows
          docker pull ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:noweb
      - name: Tag images
        run: |
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:latest ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:latest
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:latest ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:chromium
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:gows ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:gows
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:noweb ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:noweb
      - name: Login to Destination Docker HUb
        uses: docker/login-action@v3
        with:
          registry: ${{ vars.DESTINATION_DOCKER_REPO_REGISTRY }}
          username: ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}
          password: ${{ secrets.DESTINATION_DOCKER_REPO_TOKEN }}
      - name: Push images to Destination Docker HUb
        run: |
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:latest
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:chromium
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:gows
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:noweb
  cpu_arm:
    runs-on: ubuntu-24.04-arm
    environment: production
    steps:
      - name: Checkout sources
        uses: actions/checkout@v4
      - name: Login to Source Docker repository
        uses: docker/login-action@v3
        with:
          registry: ${{ vars.SOURCE_DOCKER_REPO_REGISTRY }}
          username: ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}
          password: ${{ secrets.SOURCE_DOCKER_REPO_TOKEN }}
      - name: Pull Waha Plus images
        run: |
          docker pull ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:latest-arm
          docker pull ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:gows-arm
          docker pull ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:noweb-arm
      - name: Tag images
        run: |
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:latest-arm ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:latest-arm
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:latest-arm ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:chromium-arm
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:gows-arm ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:gows-arm
          docker tag ${{ vars.SOURCE_DOCKER_REPO_USERNAME }}/waha-plus:noweb-arm ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:noweb-arm
      - name: Login to Destination Docker HUb
        uses: docker/login-action@v3
        with:
          registry: ${{ vars.DESTINATION_DOCKER_REPO_REGISTRY }}
          username: ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}
          password: ${{ secrets.DESTINATION_DOCKER_REPO_TOKEN }}
      - name: Push images to Destination Docker HUb
        run: |
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:latest-arm
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:chromium-arm
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:gows-arm
          docker push ${{ vars.DESTINATION_DOCKER_REPO_USERNAME }}/waha-plus:noweb-arm